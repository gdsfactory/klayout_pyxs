
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Writing PYXS files - an Introduction &#8212; klayout_pyxs 0.1.13 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/autodoc_pydantic.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The grow() Method" href="DocGrow.html" />
    <link rel="prev" title="klayout_pyxs 0.1.13" href="README.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">klayout_pyxs 0.1.13 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contents
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="README.html">
   klayout_pyxs 0.1.13
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Writing PYXS files - an Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DocGrow.html">
   The
   <code class="docutils literal notranslate">
    <span class="pre">
     grow()
    </span>
   </code>
   Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DocEtch.html">
   The
   <code class="docutils literal notranslate">
    <span class="pre">
     etch()
    </span>
   </code>
   Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DocReference.html">
   PYXS File Reference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="CHANGELOG.html">
   CHANGELOG
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/gdsfactory/klayout_pyxs"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/gdsfactory/klayout_pyxs/issues/new?title=Issue%20on%20page%20%2FDocIntro.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/gdsfactory/klayout_pyxs/edit/master/docs/DocIntro.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/DocIntro.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#variables-and-notation">
   Variables and notation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#input-preparation">
   Input preparation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#caveat-python-and-object-references">
     Caveat: Python and object references
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#material-data-is-layout-data-too">
     Material data is layout data too
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#etch-operations">
   Etch operations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#backside-processing">
   Backside processing
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Writing PYXS files - an Introduction</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#variables-and-notation">
   Variables and notation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#input-preparation">
   Input preparation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#caveat-python-and-object-references">
     Caveat: Python and object references
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#material-data-is-layout-data-too">
     Material data is layout data too
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#etch-operations">
   Etch operations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#backside-processing">
   Backside processing
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="writing-pyxs-files-an-introduction">
<span id="docintro"></span><h1>Writing PYXS files - an Introduction<a class="headerlink" href="#writing-pyxs-files-an-introduction" title="Permalink to this headline">#</a></h1>
<p>Cross section files are simple to write. They provide a description how
to convert a planar layout into a vertical material stack. PYXS scripts
are really “scripts” - they are small programs which are executed by
KLayout’s internal Python interpreter. Simple scripts can be written
without much knowledge of the Python language by following a simple
recipe. Complex scripts can utilize the full power of that scheme by
using loops, procedures, if statements and so on.</p>
<p>This document is an introduction into PYXS files. A reference with more
details about the functions, methods and their parameters is provided
here: <a class="reference internal" href="DocReference.html"><span class="doc">PYXS File Reference</span></a>.</p>
<p>Let us start with a simple example for a PYXS file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare input layers</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">)</span>

<span class="c1"># &quot;grow&quot; metal on mask m1 with thickness 0.3 and lateral extension 0.1</span>
<span class="c1"># with elliptical edge contours</span>
<span class="n">metal1</span> <span class="o">=</span> <span class="n">mask</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>

<span class="c1"># output the material data to the target layout</span>
<span class="n">output</span><span class="p">(</span><span class="s2">&quot;0/0&quot;</span><span class="p">,</span> <span class="n">bulk</span><span class="p">)</span>
<span class="n">output</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">,</span> <span class="n">metal1</span><span class="p">)</span>
</pre></div>
</div>
<p>With the following input:</p>
<img alt="_images/s1.png" src="_images/s1.png" />
<p>This script will produce a simple cross section:</p>
<img alt="_images/s1_xs.png" src="_images/s1_xs.png" />
<p>PYXS files are basically Python scripts, so the syntax rules for the
Python language apply. Specifically:</p>
<ul class="simple">
<li><p>Comments start with a hash symbol (<code class="docutils literal notranslate"><span class="pre">#</span></code>)</p></li>
<li><p>Functions and methods should list their parameters in round brackets
after the function/method name (i.e. <code class="docutils literal notranslate"><span class="pre">method(p1,</span> <span class="pre">p2)</span></code>)</p></li>
<li><p>Layers and materials are variables and should start with a lower
case letter (according to Python style guide
<a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP-8</a>)</p></li>
<li><p>Symbolic values (strings) are included in single or double quotes (i.e.
<code class="docutils literal notranslate"><span class="pre">'mode'</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;round&quot;</span></code>)</p></li>
<li><p>Some names are reserved and cannot be used as layer or material
names, i.e. <code class="docutils literal notranslate"><span class="pre">or</span></code>, <code class="docutils literal notranslate"><span class="pre">and</span></code>, <code class="docutils literal notranslate"><span class="pre">if</span></code>, <code class="docutils literal notranslate"><span class="pre">while</span></code>, <code class="docutils literal notranslate"><span class="pre">def</span></code>, <code class="docutils literal notranslate"><span class="pre">class</span></code> etc.
See full list here: <a class="reference external" href="https://docs.python.org/3/library/functions.html">Built-in Functions</a>.</p></li>
</ul>
<p>PYXS files typically consist of three sections: the layer preparation
step, the process description and the output section.</p>
<p>In the layer preparation step, mask layers are computed from design
layers. Often, mask data does not exactly correspond to design layers.
Mask data can be derived from design layers by:</p>
<ul class="simple">
<li><p>Sizing (shifting of the edges to the outside or inside of figures)</p></li>
<li><p>Boolean operations between two design layers (AND, OR, NOT, XOR)</p></li>
<li><p>Inversion of a layer</p></li>
</ul>
<p>The design layer to mask conversion still happens in the xy plane,
looking at the chip layout from above. Once the computation has been
finished, the layout data now represents the mask data and is converted
to a litho pattern by using the “mask” function.
In our example, no conversion takes place, and the input layer
(layer 1, datatype 0) is directly taken to be mask data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
</pre></div>
</div>
<p>The mask function will basically create the cut along the ruler and
prepare the mask to become a “seed” for subsequent grow and etch
operations. Note that using a mask seed is not mandatory. There are
also maskless operations (uniform deposit, epitaxy or planarization
steps) which do not require mask data.</p>
<p>In this example, there is just a single, mask-driven deposition step
which is performed on that mask. It uses the <code class="docutils literal notranslate"><span class="pre">grow()</span></code> method which is
applied to the litho pattern object using the <code class="docutils literal notranslate"><span class="pre">.</span></code> notation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">metal1</span> <span class="o">=</span> <span class="n">mask</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">grow()</span></code> is the method and the result of this is a “material” object.
In that case, we specify an “overgrow” with an elliptical profile. The
first argument of the <code class="docutils literal notranslate"><span class="pre">grow()</span></code> method is the thickness of the deposited
material in micrometers. The second argument is the lateral extension
(diffusion) in micrometer units. <code class="docutils literal notranslate"><span class="pre">mode='round'</span></code> is an option (a keyword
argument in Python) which specifies round or elliptical mode. In the
end, this specification will widen the original line of 0.4 micrometers
to 0.6 micrometers, because it will add 0.1 micrometers to each side
and produce a sheet thickness of 0.3 micrometers.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">grow()</span></code> method is one of the two basic methods for the process
description. It can not only grow some material atop of the current
stack but also convert material below the surface to another material.
Find more about this method here: <a class="reference internal" href="DocGrow.html"><span class="doc">The grow() Method</span></a>.</p>
<p>A material object can be used later as a target of etch processes for
example. In our case, we simply output the material to an arbitrary
output layer (here layer 1, datatype 0):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;0/0&quot;</span><span class="p">,</span> <span class="n">bulk</span><span class="p">())</span>
<span class="n">output</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">,</span> <span class="n">metal1</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">bulk()</span></code> is a pseudo-material which denotes the substrate. It is
written to layer 0, datatype 0 for illustration. In the screenshot,
the <code class="docutils literal notranslate"><span class="pre">metal1</span></code> material has been colored light red, the “bulk” material
is colored gray.</p>
<section id="variables-and-notation">
<h2>Variables and notation<a class="headerlink" href="#variables-and-notation" title="Permalink to this headline">#</a></h2>
<p>The above form of the script is not mandatory. <code class="docutils literal notranslate"><span class="pre">m1</span></code> and <code class="docutils literal notranslate"><span class="pre">metal1</span></code> are
variables which carry certain information. It is not required to store
this information in variables, except if the information is to be reused
in other places. Hence the computation of the <code class="docutils literal notranslate"><span class="pre">metal1</span></code> output can be
reduced to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">,</span> <span class="n">mask</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>But obviously readability suffers, so the expanded notation used before
is recommended. But this example illustrates that there is no magic
behind the material names - they’re just variables carrying certain
information. For the interested readers: instances of Python objects
of various kinds representing layout data or material data.</p>
</section>
<section id="input-preparation">
<h2>Input preparation<a class="headerlink" href="#input-preparation" title="Permalink to this headline">#</a></h2>
<p>As stated before, input data can be combined to produce mask data.
PYXS scripts use Python methods on layout data objects to implement
these operations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l1</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">)</span>
<span class="n">l2</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;2/0&quot;</span><span class="p">)</span>
<span class="c1"># Boolean NOT between layer 1, datatype 0 and layer 2, datatype 0</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">l1</span><span class="o">.</span><span class="n">not_</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
</pre></div>
</div>
<p>The same can be written more compactly if required. But again,
readability suffers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">not_</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="s2">&quot;2/0&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Other Boolean operations available are:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l1</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">)</span>
<span class="n">l2</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;2/0&quot;</span><span class="p">)</span>

<span class="c1"># Boolean OR between layer 1, datatype 0 and layer 2, datatype 0:</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">l1</span><span class="o">.</span><span class="n">or_</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>

<span class="c1"># Boolean AND between layer 1, datatype 0 and layer 2, datatype 0:</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">l1</span><span class="o">.</span><span class="n">and_</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>

<span class="c1"># Boolean XOR between layer 1, datatype 0 and layer 2, datatype 0:</span>
<span class="n">p3</span> <span class="o">=</span> <span class="n">l1</span><span class="o">.</span><span class="n">xor</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
</pre></div>
</div>
<p>Layers can be sized (biased). Sizing will shift the edges by the
specified value in micrometer units. Positive values will shift the
edges to the outside of the figures, negative values to the inside.
Hence a positive value with increase the width of a line by twice that
value, a negative value will reduce the width by twice the value.
Negative values may make figures vanish fully or partially, positive
values may remove holes or gaps in the layout.</p>
<p>Sizing is available in two flavors: a modifying (in-place) version and
version delivering a sized copy (out-of-place). Both methods accept one
or two values. If one value is given, the bias will be applied in x
and y direction, with two values, the first bias will be applied in
horizontal direction, the other one in vertical direction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l1</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">)</span>

<span class="c1"># p will be a copy of layer 1, datatype 0, sized by 0.2 micrometers:</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">l1</span><span class="o">.</span><span class="n">sized</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>

<span class="c1"># this will modify l1 by sizing it with a value of 0.1 in x direction only:</span>
<span class="n">l1</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Layers can be inverted. Again there is a in-place and out-of-place
version of that method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l1</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">)</span>

<span class="c1"># Inverts the layer (modifies l1):</span>
<span class="n">l1</span><span class="o">.</span><span class="n">invert</span><span class="p">()</span>

<span class="c1"># Returns an inverted copy (which is identical with layer 1, datatype 0 again):</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">l1</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span>
</pre></div>
</div>
<section id="caveat-python-and-object-references">
<h3>Caveat: Python and object references<a class="headerlink" href="#caveat-python-and-object-references" title="Permalink to this headline">#</a></h3>
<p>When assigning something to another variable it is easy to make a common
mistake: when Python assigns something to another variable, it will
(except for basic types) create another <strong>reference</strong> to the object,
not a copy. That has a strange consequence:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span>

<span class="c1"># this will invert &quot;b&quot; too, since b references the same object as a:</span>
<span class="n">a</span><span class="o">.</span><span class="n">invert</span><span class="p">()</span>
</pre></div>
</div>
<p>To create a real copy, either use the out-of-place methods or use the
<code class="docutils literal notranslate"><span class="pre">dup()</span></code> method which creates a copy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution 1:</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span>

<span class="c1"># Solution 2:</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">dup</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">invert</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="material-data-is-layout-data-too">
<h3>Material data is layout data too<a class="headerlink" href="#material-data-is-layout-data-too" title="Permalink to this headline">#</a></h3>
<p>Material data derived from deposition methods is layout data too,
although not related to design layers. That allows to apply boolean
operations and sizing to material data as well:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l1</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">)</span>
<span class="n">l2</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;2/0&quot;</span><span class="p">)</span>

<span class="n">metal1a</span> <span class="o">=</span> <span class="n">mask</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>
<span class="n">metal1b</span> <span class="o">=</span> <span class="n">mask</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span>

<span class="n">output</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">,</span> <span class="n">metal1a</span><span class="o">.</span><span class="n">or_</span><span class="p">(</span><span class="n">metal1b</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="etch-operations">
<h2>Etch operations<a class="headerlink" href="#etch-operations" title="Permalink to this headline">#</a></h2>
<p>The next sample script demonstrates the etch operation and mask-less
deposit methods. It is closer to a real process, which does not use
“mask-driven” grow but rather deposition and etch. It uses a layer
inversion to turn the polarity of the mask: etching has to happen where
no structure is drawn in order to produce the structure where it was
drawn.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare input layers</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">)</span>
<span class="n">m1i</span> <span class="o">=</span> <span class="n">m1</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span>

<span class="c1"># deposit metal with width 0.25 micron</span>
<span class="n">metal1</span> <span class="o">=</span> <span class="n">deposit</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

<span class="n">substrate</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">()</span>

<span class="c1"># etch metal on mask m1 with thickness 0.3 and lateral extension 0.1</span>
<span class="c1"># with elliptical edge contours</span>
<span class="n">mask</span><span class="p">(</span><span class="n">m1i</span><span class="p">)</span><span class="o">.</span><span class="n">etch</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">into</span><span class="o">=</span><span class="p">[</span><span class="n">metal1</span><span class="p">,</span> <span class="n">substrate</span><span class="p">])</span>

<span class="c1"># output the material data to the target layout</span>
<span class="n">output</span><span class="p">(</span><span class="s2">&quot;0/0&quot;</span><span class="p">,</span> <span class="n">substrate</span><span class="p">)</span>
<span class="n">output</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">,</span> <span class="n">metal1</span><span class="p">)</span>
</pre></div>
</div>
<p>With the following input:</p>
<img alt="_images/s2.png" src="_images/s2.png" />
<p>This script will produce the following cross-section:</p>
<img alt="_images/s2_xs.png" src="_images/s2_xs.png" />
<p>The layer preparation step performs the inversion using the <code class="docutils literal notranslate"><span class="pre">inverted()</span></code>
method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m1</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">)</span>
<span class="n">m1i</span> <span class="o">=</span> <span class="n">m1</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">m1i</span></code> will be the inverted <code class="docutils literal notranslate"><span class="pre">m1</span></code> mask and will be used as the “seed” for
the etch.</p>
<p>Because we etch into the substrate we have to provide substrate as a
material too. This is achieved with the following assignment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">substrate</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">bulk()</span></code> is a pseudo-material describing the wafer substrate. Initially
it is the wafer material below the surface. <code class="docutils literal notranslate"><span class="pre">bulk()</span></code> is a function,
so we have to create a material we can modify by storing the material
data object in a variable we call <code class="docutils literal notranslate"><span class="pre">substrate</span></code>.</p>
<p>The etch step will now start from the inverted metal1 mask. Etch depth
will be 0.3 micrometers, and we specify an underetch of 0.1 micrometers
with elliptical profile. For the etch method we have to specify the
material our etch process will remove. There is no differentiation in
etch rate for these materials - they are assumed to behave the same way.
Materials not listed will effectively form an etch stop.</p>
<p>The materials the etch method will remove are listed with the <code class="docutils literal notranslate"><span class="pre">into</span></code>
parameter. This named parameter is mandatory for the etch method.
The argument of that parameter is a material object or an array of
objects, if multiple materials are to be removed. Arrays are formed by
enclosing the list in square brackets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span><span class="p">(</span><span class="n">m1i</span><span class="p">)</span><span class="o">.</span><span class="n">etch</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">into</span><span class="o">=</span><span class="p">[</span><span class="n">metal1</span><span class="p">,</span> <span class="n">substrate</span><span class="p">])</span>
</pre></div>
</div>
<p>Because we etch deeper (0.3) than the sheet we have deposited before
(0.25), we will remove a little bit of substrate as well. Note also,
that we reduce the line with from 0.8 (drawn) to 0.6 at the top edge of
the metal line. This bias will typically be compensated by a sizing
operation when the mask data is prepared in a real process.</p>
<p>Find details about the <code class="docutils literal notranslate"><span class="pre">etch()</span></code> method here: <a class="reference internal" href="DocEtch.html"><span class="doc">The etch() Method</span></a>.</p>
</section>
<section id="backside-processing">
<h2>Backside processing<a class="headerlink" href="#backside-processing" title="Permalink to this headline">#</a></h2>
<p>The last sample script demonstrates combinations of process steps and
backside processing. Here is the script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify wafer thickness</span>
<span class="n">depth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Prepare input layers</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="s2">&quot;2/0&quot;</span><span class="p">)</span>

<span class="c1"># deposit metal with width 0.25 micron</span>
<span class="n">metal1</span> <span class="o">=</span> <span class="n">deposit</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

<span class="n">substrate</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">()</span>

<span class="c1"># etch metal on mask m1 with thickness 0.3 and lateral extension 0.1</span>
<span class="c1"># with elliptical edge contours</span>
<span class="n">mask</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span><span class="o">.</span><span class="n">etch</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">into</span><span class="o">=</span><span class="p">[</span><span class="n">metal1</span><span class="p">,</span> <span class="n">substrate</span><span class="p">])</span>

<span class="c1"># process from the backside</span>
<span class="n">flip</span><span class="p">()</span>

<span class="c1"># backside etch, taper angle 4 degree</span>
<span class="n">mask</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span><span class="o">.</span><span class="n">etch</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">taper</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">into</span><span class="o">=</span><span class="n">substrate</span><span class="p">)</span>

<span class="c1"># fill with metal and polish</span>
<span class="n">metal2</span> <span class="o">=</span> <span class="n">deposit</span><span class="p">(</span><span class="mf">1.1</span><span class="p">)</span>
<span class="n">planarize</span><span class="p">(</span><span class="n">downto</span><span class="o">=</span><span class="n">substrate</span><span class="p">,</span> <span class="n">into</span><span class="o">=</span><span class="n">metal2</span><span class="p">)</span>

<span class="c1"># output the material data to the target layout</span>
<span class="n">output</span><span class="p">(</span><span class="s2">&quot;0/0&quot;</span><span class="p">,</span> <span class="n">substrate</span><span class="p">)</span>
<span class="n">output</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">,</span> <span class="n">metal1</span><span class="o">.</span><span class="n">or_</span><span class="p">(</span><span class="n">metal2</span><span class="p">))</span>
</pre></div>
</div>
<p>With the following input:</p>
<img alt="_images/s3.png" src="_images/s3.png" />
<p>This script will produce the following cross section:</p>
<img alt="_images/s3_xs.png" src="_images/s3_xs.png" />
<p>The topside processing part is the same than the previous sample and
produces a metal structure at the top of the wafer. For backside
processing, it is important to specify the wafer thickness. For
illustration we use an unreasonably small value of 1 micrometer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">depth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The interesting part starts with this line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">flip</span><span class="p">()</span>
</pre></div>
</div>
<p>This will basically turn the wafer and processing now happens from the
backside. You can flip again to return to top side processing. We use a
sequence of operations to create a filled through-silicon via:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># backside etch, taper angle 4 degree</span>
<span class="n">mask</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span><span class="o">.</span><span class="n">etch</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">taper</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">into</span><span class="o">=</span><span class="n">substrate</span><span class="p">)</span>

<span class="c1"># fill with metal and polish</span>
<span class="n">metal2</span> <span class="o">=</span> <span class="n">deposit</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">)</span>
<span class="n">planarize</span><span class="p">(</span><span class="n">downto</span><span class="o">=</span><span class="n">substrate</span><span class="p">,</span> <span class="n">into</span><span class="o">=</span><span class="n">metal2</span><span class="p">)</span>
</pre></div>
</div>
<p>The etch step is configured to produce a tapered hole with a taper angle
of 4 degree. The initial (now bottom) dimension of the hole is defined
by the <code class="docutils literal notranslate"><span class="pre">m2</span></code> mask which is shown in blue color in the layout and the
structure has a dimension of 0.4 micrometers.</p>
<p>After the hole has been etched, we deposit a metal layer thick enough
to fill the hole. 0.3 micrometer layer thickness is sufficient. The
deposition will cover the side walls of the hole and fill the hole
completely. Square mode is creating a square profile which is not
realistic, but computationally simple.</p>
<p>The deposition will also create metal at the bottom side of the wafer
which we polish away with a planarization step. The planarization step
is similar to a maskless etch, but it will remove the specified material
down to a certain depth. This stop condition is defined either by a
planarization stop material (here: substrate) or by a threshold value.</p>
<p>On output we merge both metal types (front and backside deposited
material) to form a joined metal structure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">output</span><span class="p">(</span><span class="s2">&quot;1/0&quot;</span><span class="p">,</span> <span class="n">metal1</span><span class="o">.</span><span class="n">or_</span><span class="p">(</span><span class="n">metal2</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="README.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">klayout_pyxs 0.1.13</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="DocGrow.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">The <code class="docutils literal notranslate"><span class="pre">grow()</span></code> Method</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Dzmitry Pustakhod<br/>
  
      &copy; Copyright 2019, Dzmitry Pustakhod.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>